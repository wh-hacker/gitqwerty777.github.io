<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>標頭檔(header)與include | QWERTY</title>
  <meta name="author" content="HCL">
  
  <meta name="description" content="Programming, Computer Science, Note">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="標頭檔(header)與include"/>
  <meta property="og:site_name" content="QWERTY"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51310670-1', 'auto');
  ga('send', 'pageview');
</script>




  <script src="https://leancloud.cn/scripts/lib/av-0.4.6.min.js"></script>
  <script>AV.initialize("j1wjgh5yjwypwyod6e73zq5pjr9bqgsjhlsnfi6fph67olbx", "lscxm6j2o23yn0vytcywijf1xzy0pwj826eey87aw6ndq9rf");</script>

</head>



 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">QWERTY</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> 標頭檔(header)與include</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

			

	<!-- content -->
	<div class="mypage">		
	    <p>本文轉自 <a href="http://www.cplusplus.com/forum/articles/10627/" target="_blank" rel="external">headers and includes: why and how</a><br><a id="more"></a></p>
<h2 id="Why_we_need_header_files">Why we need header files</h2><ul>
<li>speeds up compile time<ul>
<li>if everything is in a single file, then everything must be fully recompiled every time you make any little change</li>
</ul>
</li>
<li>keeps your code more organized<ul>
<li>easier to find the code you are looking for</li>
</ul>
</li>
<li>allows you to separate interface from implementation<ul>
<li>make the interface visible to other .cpp files, while keeping the implementation in its own .cpp file</li>
</ul>
</li>
</ul>
<p>Compile Process  </p>
<ol>
<li>compiler generates intermediate files(object file) for each compiled source file<ol>
<li>compiler will “replace” the #include line with the actual contents of the file you’re including when it compiles the file</li>
<li>files with header extensions might be ignored by the compiler if you try to compile them</li>
</ol>
</li>
<li>then links all the object files together, which generates the final binary</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in myclass.h</span></span><br><span class="line"><span class="keyword">class</span> MyClass</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">int</span> bar;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in myclass.cpp</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "myclass.h"</span></span><br><span class="line"><span class="keyword">void</span> MyClass::foo()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//in main.cpp</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "myclass.h"  <span class="comment">// defines MyClass</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  MyClass a; <span class="comment">// no longer produces an error, because MyClass is defined</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Header files should use a .h__ extension (.h / .hpp / .hxx). Which of those you use doesn’t matter</li>
<li>C++ Source files should use a .c__ extention (.cpp / .cxx / .cc). Which of those you use doesn’t matter</li>
<li>C Source files should use .c (.c only)</li>
</ul>
<blockquote>
<p>header files are #included and not compiled, whereas source files are compiled and not #included</p>
</blockquote>
<p>The one exception is that it is sometimes (although very rarely) useful to include a source file. This scenario has to do with instantiating templates and is outside the scope of this article</p>
<h2 id="Include_guards">Include guards</h2><p>include multiple times of the same code would cause error  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// myclass.h</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> MyClass</span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">DoSomething</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "myclass.h"   <span class="comment">// define MyClass</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "myclass.h"   <span class="comment">// Compiler error - MyClass already defined</span></span></span><br></pre></td></tr></table></figure>
<p>There’s an Implicit Example </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// x.h</span></span><br><span class="line"><span class="keyword">class</span> X &#123; &#125;;</span><br><span class="line"><span class="comment">// a.h</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "x.h"</span></span><br><span class="line"><span class="keyword">class</span> A &#123; X x; &#125;;</span><br><span class="line"><span class="comment">// b.h</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "x.h"</span></span><br><span class="line"><span class="keyword">class</span> B &#123; X x; &#125;;</span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h"  <span class="comment">// also includes "x.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b.h"  <span class="comment">// includes x.h again!  ERROR</span></span></span><br></pre></td></tr></table></figure>
<p>Because of this scenario, many people are told not to put #include in header files. However this is bad advice and you should not listen to it, But remember  </p>
<ol>
<li>Only #include things you need to include</li>
<li>Guard against incidental multiple includes with include guards<ol>
<li>skipping over the entire header if it was already included</li>
</ol>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x.h</span></span><br><span class="line"><span class="preprocessor">#ifndef __X_H_INCLUDED__   <span class="comment">// if x.h hasn't been included yet...</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> __X_H_INCLUDED__   <span class="comment">//   #define this so the compiler knows it has been included</span></span></span><br><span class="line"><span class="keyword">class</span> X &#123; &#125;;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="The_“right_way”_to_include_**">The “right way” to include **</h2><p>aware of following dependencies   </p>
<ol>
<li>stuff that can be forward declared</li>
<li>stuff that needs to be #included</li>
</ol>
<p>Dedepency that should be used  </p>
<ul>
<li>do nothing if<ul>
<li>A makes no references at all to B</li>
<li>The only reference to B is in a friend declaration</li>
</ul>
</li>
<li>forward declare B if<ul>
<li>A <strong>contains</strong> a B <strong>pointer or reference</strong><ul>
<li>B* myb, B&amp; myb</li>
</ul>
</li>
<li>function has B object/pointer/reference as <strong>parementer or return type</strong><ul>
<li>B MyFunction(B myb)</li>
</ul>
</li>
</ul>
</li>
<li><h1 id="include_“b-h”_if">include “b.h” if</h1><ul>
<li>B is a <strong>parent class</strong> of A</li>
<li>A <strong>contains</strong> a B object<ul>
<li>B myb</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">myclass.h</span><br><span class="line">//=================================</span><br><span class="line">// include guard</span><br><span class="line">#ifndef __MYCLASS_H_INCLUDED__</span><br><span class="line">#define __MYCLASS_H_INCLUDED__</span><br><span class="line"></span><br><span class="line">//=================================</span><br><span class="line">// forward declared dependencies</span><br><span class="line">class Foo;</span><br><span class="line">class Bar;</span><br><span class="line"></span><br><span class="line">//=================================</span><br><span class="line">// included dependencies</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include "parent.h"</span><br><span class="line"></span><br><span class="line">//=================================</span><br><span class="line">// the actual class</span><br><span class="line">class MyClass : public Parent  // Parent object, so #include "parent.h"</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  std::vector&lt;int&gt; avector;    // vector object, so #include &lt;vector&gt;</span><br><span class="line">  Foo* foo;                    // Foo pointer, so forward declare Foo</span><br><span class="line">  void Func(Bar&amp; bar);         // Bar reference, so forward declare Bar</span><br><span class="line"></span><br><span class="line">  friend class MyFriend;       // friend declaration is not a dependency</span><br><span class="line">                               //   don't do anything about MyFriend</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif // __MYCLASS_H_INCLUDED__ </span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">### Why that is the "right way" to include</span><br><span class="line"></span><br><span class="line">- general idea is that it makes "myclass.h" fully self-contained and doesn't require any other area of the program (other than MyClass's implementation/source file) to know how MyClass works internally</span><br><span class="line">	- If some other class needs to use MyClass, it can just #include "myclass.h" and be done with it!</span><br><span class="line">- Alternative method: #include all of MyClass's dependencies before #including "myclass.h" </span><br><span class="line"></span><br><span class="line">``` cpp </span><br><span class="line">//  I want to use MyClass</span><br><span class="line">#include "myclass.h"   // will always work, no matter what MyClass looks like.</span><br><span class="line">                       // You're done</span><br><span class="line">               //  (provided myclass.h follows my outline above and does</span><br><span class="line">               //   not make unnecessary #includes)</span><br></pre></td></tr></table></figure>
<p>why alternative method is bad：you should fill out all depency header and maintain it’s order</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//  I want to use MyClass</span><br><span class="line">#include "myclass.h"</span><br><span class="line">   // ERROR 'Parent' undefined</span><br><span class="line"> </span><br><span class="line">#include "parent.h"</span><br><span class="line">#include "myclass.h"</span><br><span class="line">   // ERROR 'std::vector' undefined </span><br><span class="line">	</span><br><span class="line">#include "parent.h"</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include "myclass.h"</span><br><span class="line">   // ERROR 'Support' undefined </span><br><span class="line"></span><br><span class="line">#include "parent.h"</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include "support.h"</span><br><span class="line">#include "myclass.h"</span><br><span class="line">   // ERROR 'Support' undefined</span><br><span class="line">   // "parent.h" uses Support, and therefore you must #include "support.h" before "parent.h"</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">It is all about encapsulation. Files that want to use MyClass don't need to be aware of what MyClass uses in order for it to work, and don't need to #include any MyClass dependencies. It's all very OO friendly, very easy to use, and very easy to maintain</span><br><span class="line"></span><br><span class="line">### Circular Dependencies</span><br><span class="line"></span><br><span class="line">A circular dependency is when two (or more) classes depend on each other  </span><br><span class="line"></span><br><span class="line">``` cpp</span><br><span class="line">// a.h</span><br><span class="line">#include "b.h"</span><br><span class="line">class A &#123; B* b; &#125;;</span><br><span class="line">// b.h</span><br><span class="line">#include "a.h"</span><br><span class="line">class B &#123; A* a &#125;;</span><br></pre></td></tr></table></figure>
<p>That’s what circular inclusion does</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.cpp</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h" </span></span><br><span class="line"></span><br><span class="line">The compiler will <span class="keyword">do</span> the following:</span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h"</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// start compiling a.h</span></span><br><span class="line">   <span class="preprocessor">#<span class="keyword">include</span> "b.h"</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// start compiling b.h</span></span><br><span class="line">      <span class="preprocessor">#<span class="keyword">include</span> "a.h"</span></span><br><span class="line"></span><br><span class="line">         <span class="comment">// compilation of a.h skipped because it's guarded</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// resume compiling b.h</span></span><br><span class="line">      <span class="keyword">class</span> B &#123; A* a &#125;;        <span class="comment">// &lt;--- ERROR, A is undeclared</span></span><br></pre></td></tr></table></figure>
<p>Even though you’re #including “a.h”, the compiler is not seeing A class until B class gets compiled.<br>Solution: forward declare when you’re only using a pointer or reference</p>
<p>Situation below is conceptually impossible(not logical). The solution is to have one or both classes contain a pointer or reference to the other, rather than a full object</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.h (guarded)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b.h"</span></span><br><span class="line"><span class="keyword">class</span> A</span><br><span class="line">&#123;</span><br><span class="line">  B b;   <span class="comment">// B is an object, can't be forward declared</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// b.h (guarded)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h"</span></span><br><span class="line"><span class="keyword">class</span> B</span><br><span class="line">&#123;</span><br><span class="line">  A a;   <span class="comment">// A is an object, can't be forward declared</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Function_inlining">Function inlining</h2><p>Inline Function body needs to exist in every cpp file which calls them, otherwise you get linker errors</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> B</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Func</span><span class="params">(<span class="keyword">const</span> A&amp; a)</span>   <span class="comment">// parameter, so forward declare is okay</span></span><br><span class="line">  </span>&#123;</span><br><span class="line">    a.DoSomething();      <span class="comment">// but now that we've dereferenced it, it</span></span><br><span class="line">                          <span class="comment">//  becomes an #include dependency</span></span><br><span class="line">               <span class="comment">// = we now have a potential circular inclusion</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The key is that while inline function need to exist in the header, they <strong>do not need to exist in the class definition itself</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.h  (assume its guarded)</span></span><br><span class="line"><span class="comment">//------------------</span></span><br><span class="line"><span class="keyword">class</span> A;  <span class="comment">// forward declared dependency</span></span><br><span class="line"><span class="comment">//------------------</span></span><br><span class="line"><span class="keyword">class</span> B</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Func</span><span class="params">(<span class="keyword">const</span> A&amp; a)</span></span>;  <span class="comment">// okay, A is forward declared</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//------------------</span></span><br><span class="line"><span class="comment">//now B is already defined</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h"        <span class="comment">// can use A with include dependency without error</span></span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> B::Func(<span class="keyword">const</span> A&amp; a)</span><br><span class="line">&#123;</span><br><span class="line">  a.DoSomething();    <span class="comment">// okay!  a.h has been included</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>even if a.h includes b.h, the additional #includes don’t come up until AFTER class B is fully defined, and they are therefore harmless.</p>
<p>But putting function bodies at the end of my header is ugly. Is there a way to avoid that?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.h</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// blah blah</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> B &#123; <span class="comment">/* blah blah */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b_inline.h"  <span class="comment">// or I sometimes use "b.hpp" </span></span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">``` cpp</span><br><span class="line"><span class="comment">// b_inline.h (or b.hpp -- whatever)</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a.h"</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b.h"  <span class="comment">// not necessary, but harmless</span></span></span><br><span class="line">                <span class="comment">//  you can do this to make this "feel" like a source</span></span><br><span class="line">                <span class="comment">//  file, even though it isn't</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> B::Func(<span class="keyword">const</span> A&amp; a)</span><br><span class="line">&#123;</span><br><span class="line">  a.DoSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This seperates the interface from the implementation, while still allowing the implementation to be inlined</p>
<h2 id="Forward_declaring_templates">Forward declaring templates</h2><p>Forward declaring is pretty straight-forward when it comes to simple classes, but when dealing with template classes, things aren’t so simple</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.h</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b.h" <span class="comment">// included dependencies</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="comment">// the class template</span></span><br><span class="line"><span class="keyword">class</span> Tem</span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">/*...*/</span></span><br><span class="line">  B b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class most commonly used with 'int'</span></span><br><span class="line"><span class="keyword">typedef</span> Tem&lt;<span class="keyword">int</span>&gt; A;  <span class="comment">// typedef as 'A' </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b.h</span></span><br><span class="line"><span class="comment">// forward declared dependencies</span></span><br><span class="line"><span class="keyword">class</span> A;  <span class="comment">// error!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// the class</span></span><br><span class="line"><span class="keyword">class</span> B</span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">/* ... */</span></span><br><span class="line">  A* ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Because ‘A’ isn’t really a class, but rather a typedef, the compiler will bark at you<br>we can’t just #include “a.h” here because of a circular dependency problem</p>
<p>We need to forward typedef A  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class</span> Tem;  <span class="comment">// forward declare our template</span></span><br><span class="line"><span class="keyword">typedef</span> Tem&lt;<span class="keyword">int</span>&gt; A;               <span class="comment">// then typedef 'A' (forward typedef A instead of forward declare A)</span></span><br></pre></td></tr></table></figure>
<p>A cleaner solution is to create an <strong>alternative header</strong> which has the forward declarations of your templated classes and their typedefs</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.h</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "b.h"</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> Tem</span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">/*...*/</span></span><br><span class="line">  B b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment">//a_fwd.h</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class</span> Tem;</span><br><span class="line"><span class="keyword">typedef</span> Tem&lt;<span class="keyword">int</span>&gt; A;</span><br><span class="line"></span><br><span class="line"><span class="comment">//b.h</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "a_fwd.h"</span></span><br><span class="line"><span class="keyword">class</span> B</span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">/*...*/</span></span><br><span class="line">  A* ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This allows B to include a header which forward declares A without including the entire class definition</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>上一頁</a></li>
        

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/Unity5-Tutorial-Survival-Shooter/" class="alignright next">下一頁<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">留言</h2>

  
  	 <div id="disqus_thread">
     <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  	 </div>
  
</section>

	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2015-07-21 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/轉載/">轉載<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/c/">c<span>2</span></a></li> <li><a href="/tags/cpp/">cpp<span>2</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2015 HCL
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>

<script type="text/javascript">
var disqus_shortname = 'githubforqwerty';
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!--mathjax-->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>      


<!--leancloud page counter-->
<script>
function addCount (Counter) {
        var title = $("page-header").context.title.split('|')[0].trim();
	var url = "/" + $('.mytitle').context.URL.split("/")[3] + "/";
        var query=new AV.Query(Counter);
        //use url as unique idnetfication
        query.equalTo("url",url);
        query.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                        //alert('New object created');
                        },
                        error: function(newcounter,error){
                        alert('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                alert('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
	var titleName = $('h1')[0].textContent.trim()
        if ($('.mytitle').context.URL.split("/")[2] != "localhost:4000" && $('title').length == 1 && titleName != "QWERTY" && titleName != "Categories" && titleName != "Tags" && titleName != "彙整")
           addCount(Counter);
        var query=new AV.Query(Counter);
        query.descending("time");
        // the sum of popular posts
        query.limit(10); 
        query.find({
            success: function(results){
				
                    for(var i=0;i<results.length;i++)    
                    {
						//alert(results[i]);
                        var counter=results[i];
                        title=counter.get("title");
                        url=counter.get("url");
                        time=counter.get("time");
                        // add to the popularlist widget
                        showcontent=title+" ("+time+")";
                        //notice the "" in href
                        $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                    }
                },
            error: function(error){
                alert("Error:"+error.code+" "+error.message);
            }
            }
        )
        });
</script>

</body>
   </html>
